"use strict";(self.webpackChunk_kne_components_core=self.webpackChunk_kne_components_core||[]).push([[3308],{64998:(e,t,n)=>{n.d(t,{Z:()=>h});var s=n(55676),r=n(86122),l=n(6098),o=n.n(l),a=n(7101),c=n.n(a);const i={scroller:"style_scroller__EfuqR__lDjs9","scroller-inner":"style_scroller-inner__NJSE0__lDjs9","is-moving":"style_is-moving__jGuy0__lDjs9"};var u=n(80184);const d=e=>{let{onScroll:t,getContainer:n,...l}=e;const o=(0,r.useRef)(0),[a,d]=(0,r.useState)(!1),m=(0,r.useRef)(a);m.current=a;const h=(0,r.useRef)(t);h.current=t;const g=(0,r.useRef)(1);return g.current=l.width/l.innerWidth,(0,r.useEffect)((()=>{const e=e=>{m.current&&h.current(g.current*(e.clientX-o.current)),o.current=e.clientX},t=()=>{d(!1)};return document.addEventListener("mousemove",e,!0),document.addEventListener("mouseup",t,!0),()=>{document.removeEventListener("mousemove",e,!0),document.removeEventListener("mouseup",t,!0)}}),[]),(0,s.createPortal)(l.hasScroller?(0,u.jsx)("div",{className:i.scroller,style:{left:l.left,width:l.width,height:15},children:(0,u.jsx)("div",{className:c()(i["scroller-inner"],{[i["is-moving"]]:a}),style:{width:l.innerWidth,left:l.innerLeft},onMouseDown:e=>{e.preventDefault(),o.current=e.clientX,d(!0)}})}):null,n()||document.body)},m=e=>{let{className:t,scroller:n,getScrollTarget:s,children:l}=e;const[a,m]=(0,r.useState)({left:0,width:0,innerLeft:0,innerWidth:0,height:0,hasScroller:!1}),h=(0,r.useRef)(null),g=o()((()=>h.current&&s(h.current))),p=(0,r.useRef)();return p.current="object"===typeof n&&"function"===typeof n.getContainer?n.getContainer:()=>null,(0,r.useEffect)((()=>{const e=p.current()||document.documentElement;let t;const n=()=>{if(!t)return;const{left:n,width:s,top:r,height:l}=t.getBoundingClientRect(),o=t.offsetHeight-t.clientHeight||15,a=s*t.clientWidth/t.scrollWidth-6,c=t.scrollLeft*t.clientWidth/t.scrollWidth+2,i=e.getBoundingClientRect();m((u=>Object.assign({},u,{left:n,width:s,innerLeft:c,innerWidth:a,height:o,hasScroller:t.scrollWidth-t.clientWidth>0&&(e===document.documentElement?r+l-e.offsetHeight>0&&r<e.offsetHeight:r<i.top+i.height&&r+l>i.top+i.height)})))},s=new ResizeObserver(n);return new ResizeObserver((()=>{t=g(),t&&(s.disconnect(),n(),Array.from(t.children).forEach((e=>{s.observe(e)})),t.addEventListener("scroll",n))})).observe(h.current),window.addEventListener("scroll",n),e.addEventListener("scroll",n),()=>{window.removeEventListener("scroll",n),e.removeEventListener("scroll",n)}}),[g]),n?(0,u.jsxs)("div",{className:c()(i["scroller-outer"],t),ref:h,style:{"--scroller-bar-height":null!==a&&void 0!==a&&a.hasScroller?"15px":"0px"},children:[l,(0,u.jsx)(d,{...a,getContainer:p.current,onScroll:e=>{g().scrollLeft+=e}})]}):l};m.defaultProps={scroller:!0,getScrollTarget:()=>document.querySelector(".simplebar-content-wrapper")};const h=m},41767:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_,useFeatureCall:()=>x});var s=n(86122),r=n(43682),l=n(26181),o=n.n(l),a=n(49151),c=n.n(a),i=n(24242),u=n.n(i),d=n(80184);const m=(e,t,n)=>{e&&(Array.isArray(e)?e.forEach((e=>{m(e,t,n)})):(t(Object.assign({},u()(e,["children"]),{parentId:n})),m(e.children,t,n?n+":"+e.id:e.id)))},h=c()((e=>{const t=(()=>{const t=new Map;return m(e,(e=>{t.set(e.parentId?e.parentId+":"+e.id:e.id,e)})),t})(),n=(e=>Array.from(e.keys()).filter((t=>{const n=e.get(t);return!(Array.isArray(n.dependencies)&&n.dependencies.length>0&&n.dependencies.some((n=>!e.get(t))))})))(t);return{profile:e,features:n,profileMap:t}})),g=(e,t)=>{let{profileMap:n,features:s}=t;const r=n.get(e);return-1!==s.indexOf(e)&&!0!==r.close&&o()(r,"dependencies",[]).every((t=>{const r=n.get(e);return s.indexOf(t)>-1&&!0!==r.close}))},p=(0,s.createContext)(null),{Provider:f}=p,x=e=>{const{features:t,profile:n,profileMap:l,debug:a}=(()=>{const e=(0,r.usePreset)(),{profile:t,debug:n}=o()(e,"features",{debug:!1,profile:{}});return Object.assign({},h(t),{debug:n})})(),c="system"===n.type?n.id:"root",i=(0,s.useContext)(p),u=i?i+":"+e:c+":"+e;return(0,s.useEffect)((()=>{t&&t.length>0&&a&&console.log("[featureId] ".concat(u,",[state] ").concat(g(u,{features:t,profileMap:l})),l.get(u))}),[t,l,a,u]),{isPass:!(e&&t&&t.length>0)||g(u,{features:t,profileMap:l}),currentId:u,feature:l.get(u)}},_=e=>{let{id:t,children:n}=e;const{isPass:s,feature:r,currentId:l}=x(t);return(0,d.jsx)(f,{value:l,children:"function"===typeof n?n({isPass:s,options:s?o()(r,"options"):o()(r,"rejectedOptions"),currentId:l}):s&&n})}},73308:(e,t,n)=>{n.r(t),n.d(t,{Table:()=>B,default:()=>X});var s=n(2508),r=n(86122),l=n(6098),o=n.n(l),a=n(66005),c=n.n(a),i=n(7101),u=n.n(i),d=n(26181),m=n.n(d),h=n(64998),g=n(33107),p=n(87151),f=n.n(p),x=n(70290),_=n.n(x),j=n(83312);const y={"loading-container":"style_loading-container__tATe2__lDjs9","width-changer":"style_width-changer__2ZxQE__lDjs9","table-changer-setting":"style_table-changer-setting__vHBi5__lDjs9","width-changer-sign":"style_width-changer-sign__JpI-0__lDjs9","columns-control":"style_columns-control__Yt34Y__lDjs9","columns-control-content":"style_columns-control-content__1wnZG__lDjs9","columns-control-content-title":"style_columns-control-content-title__MsQpI__lDjs9","columns-control-content-scroller":"style_columns-control-content-scroller__VEy4q__lDjs9","columns-control-content-footer":"style_columns-control-content-footer__rvk74__lDjs9","columns-control-content-input":"style_columns-control-content-input__fYYyr__lDjs9","columns-control-content-list":"style_columns-control-content-list__wepM4__lDjs9","columns-control-content-item":"style_columns-control-content-item__1cPXT__lDjs9","is-drag":"style_is-drag__HRe9m__lDjs9","columns-control-content-item-icon":"style_columns-control-content-item-icon__oku-X__lDjs9","sortable-drag":"style_sortable-drag__N6+aC__lDjs9","sortable-ghost":"style_sortable-ghost__EbwXI__lDjs9","columns-control-overlay":"style_columns-control-overlay__QYEXZ__lDjs9"};var C=n(43682),b=n(80184);const v=e=>"TH"===e.tagName.toUpperCase()&&[].indexOf.call(e.classList,"ant-table-cell")>-1&&-1===[].indexOf.call(e.classList,"ant-table-selection-column")?e:null!==e.parentElement&&e.parentElement!==document.body&&v(e.parentElement),w=e=>{let{columns:t,setData:n,name:s,initColumnsData:l}=e;const c=(0,r.useRef)(null),i=(0,r.useRef)(s);i.current=s;const d=(0,r.useMemo)((()=>new Map(t.map((e=>[e.key,e])))),[t]),m=(0,r.useRef)(d);m.current=d;const{tablePageServerApis:h}=(0,C.usePreset)(),g=(0,j.useDebouncedCallback)((()=>{(0,a.getCache)().delByCacheName("TABLE_CONFIG_".concat(i.current)),h&&h.setDataFunc&&(h.setDataFunc(i.current,k),n(k))}),1e3),[p,x]=(0,r.useState)(!1),w=(0,r.useRef)(!1),A=(0,r.useRef)({index:-1,width:0}),[S,I]=(0,r.useState)({}),D=(0,r.useRef)(0),E=(0,r.useCallback)((()=>l&&l.length>0&&t.length===l.length&&_()(t,l,((e,t)=>e.key===t.id))?l.map((e=>{let{id:t,width:n,hidden:s}=e;return{id:t,width:n,hidden:s}})):t.map((e=>({id:e.key,hidden:e.hidden,width:e.width})))),[l,t]);(0,r.useEffect)((()=>{O(E())}),[E]);const[k,O]=(0,r.useState)(E),R=o()((e=>{O(e),g()})),L=(0,r.useRef)(k),N=(0,r.useRef)(k);L.current=N.current=k;const M=o()((()=>{const e=t.map((e=>({id:e.key,hidden:e.hidden,width:e.width})));N.current=e,R(e)}));return(0,r.useEffect)((()=>{if(!c.current)return;const e=e=>{const t=e.target;w.current||t.classList.contains("changer-sign")||v(t)||x(!1)},t=()=>{document.body.style.cursor="unset",w.current=!1,A.current={index:-1,width:0},x(!1)};return c.current.addEventListener("mousemove",(e=>{const t=v(e.target)||e.target,{left:n,top:s}=c.current.getBoundingClientRect(),{left:r,width:l,height:o}=t.getBoundingClientRect(),a=c.current.querySelector(".ant-table-thead"),i=a.getBoundingClientRect().top,u=Array.from(a.querySelectorAll("th")),d=Array.from(a.querySelectorAll("th:not(.ant-table-selection-column)"));if(!w.current&&v(t)&&0<e.pageX-r+8&&(A.current={index:d.indexOf(t),locationIndex:u.indexOf(t),width:l,left:r,height:o},I({left:r-n+l-8,top:i-s,height:o}),x(!0)),!w.current&&v(t)&&0>e.pageX-r+8&&x(!1),w.current&&A.current.index>-1){const t=e.pageX-D.current,n=(c.current.querySelector(".ant-table-body")||c.current.querySelector(".ant-table-content")).scrollLeft,r=Math.max(t+A.current.width,100);I({left:Math.max(f()(u.slice(0,A.current.locationIndex).map((e=>e.clientWidth)))-n,0)+r-8,top:i-s,height:A.current.height}),R((e=>{const t=e.slice(0);return t.filter((e=>{let{hidden:t}=e;return!0!==t})).forEach(((e,t)=>{var n;e.width=A.current.index===t?r:(null===(n=d[t])||void 0===n?void 0:n.clientWidth)||100})),t}))}}),!0),window.addEventListener("mouseup",t),document.addEventListener("mousemove",e,!0),()=>{document.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",t)}}),[M,R]),{ref:c,sign:p&&(0,b.jsx)("div",{className:u()(y["width-changer-sign"],"changer-sign"),style:{top:S.top,left:S.left,height:S.height},onMouseDown:e=>{e.preventDefault(),w.current=!0,D.current=e.pageX,document.body.style.cursor="url(".concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAUCAMAAACgaw2xAAAANlBMVEUAAAAjIyMiIiIhISEjIyMiIiIhISEiIiIjIyMiIiIjIyMjIyMiIiIiIiIiIiIiIiIiIiL///8npLH6AAAAEHRSTlMAZm9zdnd7gISIjKq78fL+6p9oYgAAAAFiS0dEEeK1PboAAAA/SURBVBgZ1cGJDYAgEEXBh7JyKPj7r9ZkQyKUwAx7yhfurCyyDHe8lUlRf4auws/U7qHJmJgSLslYxIALkS192tYB4NtE/LQAAAAASUVORK5CYII=",") 12 10,col-resize")}}),targetColumns:k.filter((e=>{let{hidden:t}=e;return!0!==t})).map((e=>{let{id:t,width:n}=e;return Object.assign({},d.get(t),{width:n,ellipsis:!1})})),popupColumns:N.current,columnMap:m.current,setColumns:e=>{N.current=e},onConfirm:()=>{R(N.current)},onCancel:()=>{N.current=L.current},onReset:()=>{M()}}},A=e=>{const t=(0,a.withFetch)(e);return n=>{const{name:s,controllerOpen:r}=n,{tablePageServerApis:l}=(0,C.usePreset)();return r&&s&&l&&l.getDataApi?(0,b.jsx)(t,{...n,...l.getDataApi(s),cache:"TABLE_CONFIG_".concat(s),isLocal:!0,ttl:5e3,error:(0,b.jsx)(e,{...n})}):(0,b.jsx)(e,{...n})}};var S=n(55198);const I=n.n(S)()(A,(e=>t=>{let{name:n,controllerOpen:s,columns:r,data:l,setData:o,...a}=t;const{ref:c,targetColumns:i,sign:d}=w({columns:r,name:n,initColumnsData:l,setData:o});return s?(0,b.jsxs)("div",{className:u()(y["width-changer"],"table-page-columns-width-changer"),ref:c,children:[(0,b.jsx)(e,{...a,name:n,controllerOpen:s,originColumns:r,tableColumnFetchApi:{data:l,setData:o},columns:i}),d]}):(0,b.jsx)(e,{columns:r,controllerOpen:s,originColumns:r,name:n,...a})}));var D=n(41767);const E=e=>({"en-US":()=>n.e(4744).then(n.bind(n,5131)),"zh-CN":()=>n.e(1423).then(n.bind(n,71423))}[e]());var k=n(91602),O=n(98444),R=n.n(O),L=n(91243),N=n(92527),M=n(85021),P=n(14250);const{Panel:z}=s.Collapse,T=e=>{let{close:t,onCancel:n,onConfirm:l,onReset:o,columns:a,setColumns:c}=e;const[i,d]=(0,r.useState)(a),[m,h]=(0,r.useState)(""),{leftFixedColumns:g,rightFixedColumns:p,visibleColumns:f,hiddenColumns:x}=(0,r.useMemo)((()=>Object.assign({leftFixedColumns:[],rightFixedColumns:[],visibleColumns:[],hiddenColumns:[]},R()(i,(e=>"right"===e.fixed?"rightFixedColumns":!0===e.fixed||"left"===e.fixed?"leftFixedColumns":e.hidden?"hiddenColumns":"visibleColumns")))),[i]),_=e=>{d(e),c(e)};return(0,b.jsxs)("div",{className:y["columns-control-content"],children:[(0,b.jsx)("div",{className:y["columns-control-content-title"],children:(0,b.jsxs)(s.Row,{align:"middle",justify:"space-between",children:[(0,b.jsx)(s.Col,{children:"\u7f16\u8f91\u8868\u683c"}),(0,b.jsx)(s.Col,{children:(0,b.jsx)(s.Tooltip,{title:"\u6062\u590d\u9ed8\u8ba4",children:(0,b.jsx)(N.default,{type:"text",icon:(0,b.jsx)(L.default,{type:"icon-huifumorenshezhi"}),onClick:async()=>{o&&await o(),t()}})})})]})}),(0,b.jsx)("div",{className:y["columns-control-content-scroller"],children:(0,b.jsxs)(s.Collapse,{defaultActiveKey:["active","un-active"],ghost:!0,bordered:!0,children:[(0,b.jsx)(z,{header:"\u663e\u793a\u7684\u4fe1\u606f",children:(0,b.jsxs)(s.List,{className:y["columns-control-content-list"],children:[g.map((e=>(0,b.jsx)(s.List.Item,{className:y["columns-control-content-item"],children:(0,b.jsx)(s.Checkbox,{checked:!0,disabled:!0,children:e.name})},e.id))),(0,b.jsx)(P.ReactSortable,{list:f,filter:".ignore-elements",dragClass:y["sortable-drag"],ghostClass:y["sortable-ghost"],forceFallback:!0,setList:e=>{_([...g,...e,...x,...p])},animation:300,delayOnTouchStart:!0,delay:2,children:f.map((e=>(0,b.jsxs)(s.List.Item,{className:u()(y["columns-control-content-item"],y["is-drag"]),children:[(0,b.jsx)(L.default,{type:"icon-paixu",className:y["columns-control-content-item-icon"]}),(0,b.jsx)(s.Checkbox,{checked:!0,disabled:e.fixed,onChange:t=>{t.stopPropagation(),t.preventDefault();const n=i.indexOf(e),s=i.slice(0);s[n]=Object.assign({},s[n],{hidden:!0}),_(s)},children:e.name})]},e.id)))}),p.map((e=>(0,b.jsx)(s.List.Item,{className:y["columns-control-content-item"],children:(0,b.jsx)(s.Checkbox,{checked:!0,disabled:!0,children:e.name})},e.id)))]})},"active"),(0,b.jsx)(z,{header:(0,b.jsxs)(s.Row,{wrap:!1,justify:"space-between",children:[(0,b.jsx)(s.Col,{children:"\u9690\u85cf\u7684\u4fe1\u606f"}),(0,b.jsx)(s.Col,{onClick:e=>{e.stopPropagation(),e.preventDefault()},children:(0,b.jsx)(M.SearchInput,{prefix:(0,b.jsx)(L.default,{type:"icon-sousuo",size:12}),placeholder:"\u641c\u7d22",onSearch:e=>{h(e)},className:y["columns-control-content-input"],size:"small"})})]}),children:(0,b.jsx)(s.List,{dataSource:x.filter((e=>"string"===typeof e.name&&e.name.indexOf(m)>-1)),renderItem:e=>(0,b.jsx)(s.List.Item,{className:y["columns-control-content-item"],children:(0,b.jsx)(s.Checkbox,{checked:!1,onChange:t=>{t.stopPropagation(),t.preventDefault();const n=i.indexOf(e),s=i.slice(0);s[n]=Object.assign({},s[n],{hidden:!1,width:s[n].width||200}),_(s)},children:e.name})},e.id)})},"un-active")]})}),(0,b.jsxs)(s.Row,{className:y["columns-control-content-footer"],justify:"end",gutter:10,children:[(0,b.jsx)(s.Col,{children:(0,b.jsx)(s.Button,{size:"small",onClick:()=>{n&&n(),t()},children:"\u53d6\u6d88"})}),(0,b.jsx)(s.Col,{children:(0,b.jsx)(N.default,{type:"primary",size:"small",onClick:async()=>{l&&await l(),t()},children:"\u786e\u5b9a"})})]})]})},F=e=>{let{columns:t,name:n,data:l,setData:o,...a}=e;const[c,i]=(0,r.useState)(!1),{popupColumns:u,columnMap:d,setColumns:h,onConfirm:g,onCancel:p,onReset:f}=w({columns:t,name:n,initColumnsData:l,setData:o});return(0,b.jsx)(s.Popover,{...a,open:c,overlayClassName:y["columns-control-overlay"],trigger:"click",autoAdjustOverflow:!1,placement:"bottomRight",content:(0,b.jsx)(T,{columns:u.map((e=>{const t=d.get(e.id);return Object.assign({},e,{name:m()(t,"titleText")||m()(t,"title")||"\u672a\u547d\u540d\u5217",fixed:m()(t,"fixed")})})),setColumns:e=>{h(e.map((e=>{let{id:t,width:n,hidden:s}=e;return{id:t,width:n,hidden:s}})))},close:()=>i(!1),onConfirm:g,onCancel:p,onReset:f}),onOpenChange:e=>i(e),children:(0,b.jsx)("span",{className:y["table-changer-setting"],children:(0,b.jsx)(L.default,{type:"icon-shezhi"})})})},B=I((e=>{let{className:t,columns:n,originColumns:r,controllerOpen:l,tableColumnFetchApi:o,name:a,scroller:c,featureId:i,...d}=e;const{data:g,setData:p}=o||{},f=e=>{let{children:t}=e;return i?(0,b.jsx)(D.default,{id:i,children:e=>t(e)}):t({})};return(e=>(0,b.jsx)(h.Z,{className:"table-page-scroller",scroller:c,getScrollTarget:e=>e.querySelector(".ant-table-body")||e.querySelector(".ant-table-content"),children:f({children:n=>{let{options:o}=n;const c=e.filter((e=>!e.key||(!Array.isArray(m()(o,"hiddenColumns"))||-1===o.hiddenColumns.indexOf(e.key))));return(0,b.jsx)(s.Table,{...d,columns:!1===l?c:c.map(((e,t)=>c.length-1===t?{...e,title:()=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{children:e.title}),(0,b.jsx)(F,{data:g,columns:r,setData:p,name:a})]})}:e)),className:u()(t,"table-page")})}})}))(n)})),q=(0,a.withFetch)((e=>{let{data:t,refresh:n,reload:s,requestParams:l,fetchProps:a,isComplete:i,setData:d,loadMore:h,send:g,dataFormat:p,pagination:f,scroller:x,getColumns:_,getColumnsParams:j,className:C,columns:v,featureId:w,stickyOffset:A,...S}=e;const I=o()(p),D=o()(_),O=(0,r.useMemo)((()=>I(t)),[t,I]),R={dataSource:O.list,pagination:!!f.open&&{total:O.total,showTotal:e=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.FormattedMessage,{id:"Page_Total",moduleName:"TablePage",defaultMessage:"\u5171"}),(0,b.jsx)("span",{className:y.total_text,children:e}),(0,b.jsx)(k.FormattedMessage,{id:"Page_TotalCount",moduleName:"TablePage",defaultMessage:"\u6761"})]}),current:m()(l,[f.paramsType,f.current],1),pageSize:f.defaultPageSize,onChange:f.onChange?f.onChange:(e,t)=>{e!==m()(l,[f.paramsType,f.current],1)?("refresh"===f.requestType?n:s)({[f.paramsType]:{[f.current]:e,[f.pageSize]:t}}):f.onShowSizeChange&&f.onShowSizeChange(e,t)},size:f.size,showSizeChanger:f.showSizeChanger,showQuickJumper:f.showQuickJumper},className:C,style:{"--sticky-offset":A}};return(0,b.jsx)(k.IntlProvider,{importMessages:E,moduleName:"TablePage",children:(0,b.jsx)("div",{className:u()(y["loading-container"],"loading-container",{"is-loading":!i}),children:"function"!==typeof _||v?(0,b.jsx)(B,{...S,...R,columns:v,scroller:x,featureId:w}):(0,b.jsx)(c(),{data:t,params:j,loader:e=>{let{data:t,params:n}=e;return D({data:t,params:n,formatData:O})},render:e=>{let{data:t}=e;return(0,b.jsx)(B,{...S,...R,columns:t,scroller:x,featureId:w})}})})})})),W=(0,r.forwardRef)(((e,t)=>{let{pagination:n,...s}=e;const[l,o]=(0,r.useState)(20);n=Object.assign({},{showSizeChanger:!0,showQuickJumper:!0,open:!0,paramsType:"data",requestType:"reload",current:"currentPage",pageSize:"perPage",size:"default"},n);const a=(0,r.useMemo)((()=>{const e={};return s.params&&Object.keys(s.params).length>0&&(e.params={...s.params,[n.pageSize]:l}),s.data&&Object.keys(s.data).length>0&&(e.data={...s.data,[n.pageSize]:l}),e}),[s.params,s.data,n.pageSize,l]);return(0,b.jsx)(q,{...s,pagination:Object.assign({},{defaultPageSize:l,onShowSizeChange:(e,t)=>{o(t)}},n),...a,ref:t})}));W.defaultProps={controllerOpen:!0,size:"middle",stickyOffset:"var(--nav-height)",sticky:{getContainer:g.R},scroller:{getContainer:g.R},scroll:{x:"max-content"},rowKey:"id",pagination:{},dataFormat:e=>({list:e.pageData,total:e.totalCount})};const X=W}}]);
//# sourceMappingURL=3308.5bebd49e.chunk.js.map