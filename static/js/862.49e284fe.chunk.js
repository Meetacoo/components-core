(self.webpackChunk_kne_components_core=self.webpackChunk_kne_components_core||[]).push([[862],{69013:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r=(t,e)=>{let n=t.split(","),r=n[0].match(/:(.*?);/)[1]||"image/jpeg",a=r.split("/")[1]||"jpg";const o=window.atob(n[1]);let s=o.length;const i=new Uint8Array(s);for(;s--;)i[s]=o.charCodeAt(s);return new File([i],"".concat(e,".").concat(a),{type:r})}},28457:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r=t=>!!t&&/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/.test(t)},29790:(t,e,n)=>{"use strict";n.d(e,{Z:()=>Z});var r=n(97366),a=n(97433),o=n.n(a),s=n(42415),i=n.n(s),c=n(43682),l=n(66195),d=n.n(l),u=(n(86009),n(7101)),h=n.n(u),p=n(86122),f=n(2508),m=n(44439),g=n(16907),v=n.n(g),y=n(69013),b=n(28457),w=n(80184);const x=[[{header:[1,2,3,4,5,6,!1]}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["image"],["link"],["clean"]],_=t=>{const e=document.createElement("div");return e.innerHTML=t,{text:e.innerText}},k=t=>{const e=document.createElement("A");return e.href=t,e},O=t=>{let{className:e,readOnly:n,preview:a,onBlur:s,placeholder:l,hideToolbar:u,border:g,domain:O,folder:Z,type:j,maxHeight:I,...A}=t;const[P,T]=o()(A),E=(0,p.useRef)(!1),S=(0,p.useRef)(null),q=i()((()=>{s&&s()})),{ossApi:z,ossToStatic:M,ajax:N,urlToOss:C}=(0,c.usePreset)(),F=(0,p.useMemo)((()=>P&&"[object Object]"===Object.prototype.toString.call(P)?P.hasOwnProperty("ops")?P:P.hasOwnProperty("blocks")?(t=>{const e=[];for(let n=0;n<(t.blocks||[]).length;n++){const r=t.blocks[n];if(r.data&&("header"===r.type&&(e.push({insert:"".concat(_(r.data.text).text)}),e.push({attributes:{header:r.data.level},insert:"\n"})),"paragraph"===r.type&&e.push({insert:"".concat(_(r.data.text).text,"\n")}),"delimiter"===r.type&&(e.push({attributes:{color:"#000000",size:"huge",bold:!0},insert:" * * *"}),e.push({attributes:{align:"center"},insert:"\n"})),"image"===r.type&&e.push({insert:{image:r.data.file.hasOwnProperty("id")?"".concat(window.location.origin,"/attachment/").concat(r.data.file.id,".png?id=").concat(r.data.file.id,"&originalName=").concat(r.data.file.filename):r.data.file.url}}),"list"===r.type&&(r.data.items||[]).map((t=>{e.push.apply(e,[{insert:"".concat(_(t.content).text)},{attributes:{list:"bullet"},insert:"\n"}])})),"attaches"===r.type)){const t=(0,m.get)(r.data,"file.title")||(0,m.get)(r.data,"title")||"",n=(0,m.get)(r.data,"file.extension")||t.substring(t.lastIndexOf(".")+1),a=r.data.file.hasOwnProperty("id")?"".concat(window.location.origin,"/attachment/").concat(r.data.file.id,".").concat(n,"?id=").concat(r.data.file.id,"&originalName=").concat(t):r.data.file.url;e.push.apply(e,[{attributes:{link:a},insert:t},{insert:"\n"}])}}return{ops:e}})(P):P:P&&"string"===typeof P?{ops:[{insert:"".concat(_(P).text,"\n")}]}:{ops:[]}),[P]),D=((0,p.useMemo)((()=>!(!P||"[object Object]"!==Object.prototype.toString.call(P)||!P.hasOwnProperty("blocks"))),[P]),async(t,e)=>{const n=k(t),r=new URLSearchParams(n.search),a=null===r||void 0===r?void 0:r.get("id"),o=n.pathname.substring(n.pathname.lastIndexOf("/")+1),s=a||o.substring(0,o.lastIndexOf("."));if(s){const{data:n}=await N((0,m.merge)({},z,{params:{id:s},showError:!1})),r=z.transformData?z.transformData(n):n.data;return r?await C({url:v()(r),folder:e}):t}const i=await C({url:t,folder:e});return i||t}),L=async()=>{const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.click(),t.onchange=()=>{const e=t.files[0],n=f.message.loading("\u4e0a\u4f20\u4e2d...",0);M({file:e,folder:Z}).then((t=>{var e;let r=null===S||void 0===S||null===(e=S.current)||void 0===e?void 0:e.getEditor();const a=r.getSelection().index;r.insertEmbed(a,"image",t,"api"),r.setSelection(a+1),n()}))}},H=async()=>{var t,e;if(S.current){var n=null===(t=q.current)||void 0===t?void 0:t.querySelectorAll(".ql-container img");for(let t=0;t<n.length;t++){const e=n[t];let r=k(e.src);const a=new Image;a.src=e.src;const o=O.some((t=>t.host===r.hostname)),s=O.some((t=>t.host===r.hostname&&!0===t.update));if(o)a.onerror=()=>{s&&D(e.src,Z).then((t=>{e.src=t}))};else if(/^data:image/.test(e.src)){const t=(0,m.uniqueId)("base64_")+(new Date).getTime(),n=(0,y.Z)(e.src,t);M({file:n,folder:Z}).then((async t=>{e.src=t}))}else(0,b.Z)(e.src)&&C({url:v()(e.src),folder:Z}).then((t=>{t&&(e.src=t)}))}var r=null===(e=q.current)||void 0===e?void 0:e.querySelectorAll(".ql-container a");for(let t=0;t<r.length;t++){const e=r[t];if((0,b.Z)(e.href)){let t=k(e.href);O.some((e=>e.host===t.hostname&&!0===e.update))&&D(e.href,Z).then((t=>{e.href=t}))}}}},R=(0,p.useMemo)((()=>({toolbar:{container:x,handlers:{image:t=>{L.call(void 0,A)}}}})),[]);return(0,p.useEffect)((()=>{E.current=!1;const t=setInterval((()=>{S.current&&S.current.editor&&(E.current=!0,H(),clearInterval(t))}),10);return()=>{t&&clearInterval(t)}}),[]),(0,w.jsx)("div",{ref:q,style:{"--max-height":I&&!(0,m.isNaN)(parseFloat(I))?parseFloat(I)+"px":""},className:h()(e,r.Z["rich-editor"],{[r.Z["read-only"]]:a||n,[r.Z.hidden]:a||u||n,[r.Z["no-border"]]:!1===g}),children:(0,w.jsx)(d(),{ref:S,readOnly:n,modules:R,value:"html"===j?P:F,placeholder:l,theme:"snow",onChange:async(t,e,n,r)=>{const a="html"===j?r.getHTML():r.getContents();H();const o="html"===j?a:await(async t=>{const e=(0,m.get)(t,"ops")||[];for(let n=0;n<e.length;n++){const t=e[n],r=(0,m.get)(t,"insert.image");if(r){let e=k(r);const n=O.some((t=>t.host===e.hostname)),a=O.some((t=>t.host===e.hostname&&!0===t.update));if(n){const e=a?await D(r,Z):r;t.insert.image=e}else if(/^data:image/.test(r)){const e=(0,m.uniqueId)("base64_")+(new Date).getTime(),n=(0,y.Z)(r,e),a=await M({file:n,folder:Z});t.insert.image=a}else if((0,b.Z)(r)){const e=await C({url:v()(r),folder:Z});t.insert.image=e||r}}}return{ops:e}})(a);T&&T(o)}})})};O.defaultProps={placeholder:"\u8bf7\u8f93\u5165",hideToolbar:!1,border:!0,value:null,readOnly:!1,preview:!1,defaultValue:{ops:[]},folder:"richEditor",domain:[{host:"localhost",update:!0},{host:"attachment.dev.fatalent.cn",update:!0},{host:"attachment.test.fatalent.cn",update:!0},{host:"attachment.fatalent.cn",update:!0},{host:"fat-dev-static.oss-cn-shanghai.aliyuncs.com"},{host:"fat-test-static.oss-cn-shanghai.aliyuncs.com"},{host:"fat-static.oss-cn-shanghai.aliyuncs.com"}]};const Z=O},19997:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});var r=n(49338),a=n(29790);const{useOnBlur:o}=r.hooks,s=t=>o(t)(a.Z);s.Field=s.field=a.Z;const i=s},31211:t=>{t.exports=function(t,e,n,r){for(var a=-1,o=null==t?0:t.length;++a<o;){var s=t[a];e(r,s,n(s),t)}return r}},38430:(t,e,n)=>{var r=n(87927);t.exports=function(t,e,n,a){return r(t,(function(t,r,o){e(a,t,n(t),o)})),a}},87927:(t,e,n)=>{var r=n(15358),a=n(63173)(r);t.exports=a},58645:t=>{t.exports=function(t,e){for(var n,r=-1,a=t.length;++r<a;){var o=e(t[r]);void 0!==o&&(n=void 0===n?o:n+o)}return n}},74629:(t,e,n)=>{var r=n(31211),a=n(38430),o=n(56025),s=n(93629);t.exports=function(t,e){return function(n,i){var c=s(n)?r:a,l=e?e():{};return c(n,t,o(i,2),l)}}},63173:(t,e,n)=>{var r=n(21473);t.exports=function(t,e){return function(n,a){if(null==n)return n;if(!r(n))return t(n,a);for(var o=n.length,s=e?o:-1,i=Object(n);(e?s--:++s<o)&&!1!==a(i[s],s,i););return n}}},21867:(t,e,n)=>{var r=n(2646),a=n(39753);t.exports=function(t,e,n){var o=null==t?0:t.length;return o?(e=n||void 0===e?1:a(e),r(t,0,(e=o-e)<0?0:e)):[]}},98444:(t,e,n)=>{var r=n(32526),a=n(74629),o=Object.prototype.hasOwnProperty,s=a((function(t,e,n){o.call(t,n)?t[n].push(e):r(t,n,[e])}));t.exports=s},70290:(t,e,n)=>{var r=n(71848);t.exports=function(t,e,n){var a=(n="function"==typeof n?n:void 0)?n(t,e):void 0;return void 0===a?r(t,e,void 0,n):!!a}},87151:(t,e,n)=>{var r=n(58645),a=n(52173);t.exports=function(t){return t&&t.length?r(t,a):0}},39753:(t,e,n)=>{var r=n(91495);t.exports=function(t){var e=r(t),n=e%1;return e===e?n?e-n:e:0}},32883:()=>{},20717:()=>{},86009:()=>{},97366:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r={"rich-editor":"style_rich-editor__guy9h__kpzZ4","read-only":"style_read-only__mFMiA__kpzZ4",hidden:"style_hidden__IUpV4__kpzZ4","no-border":"style_no-border__bKLqc__kpzZ4"}}}]);
//# sourceMappingURL=862.49e284fe.chunk.js.map