(self.webpackChunk_kne_components_components_core=self.webpackChunk_kne_components_components_core||[]).push([[9390],{55109:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>S});var a=n(96252);const r="style_rich-editor__guy9h__DdjY3",o="style_read-only__mFMiA__DdjY3",s="style_hidden__IUpV4__DdjY3",i="style_no-border__bKLqc__DdjY3";var l=n(10986),c=n.n(l),u=n(78491),d=n.n(u),h=n(76329),p=n(39803),f=n.n(p),m=(n(25884),n(83136)),g=n.n(m),v=n(73884),y=n(55199),b=n(21079),w=n(18081),x=n.n(w);const _=(t,e)=>{let n=t.split(","),a=n[0].match(/:(.*?);/)[1]||"image/jpeg",r=a.split("/")[1]||"jpg";const o=window.atob(n[1]);let s=o.length;const i=new Uint8Array(s);for(;s--;)i[s]=o.charCodeAt(s);return new File([i],"".concat(e,".").concat(r),{type:a})},O=t=>!!t&&/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/.test(t);var j=n(70579);const k=[[{header:[1,2,3,4,5,6,!1]}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["image"],["link"],["clean"]],I=t=>{const e=document.createElement("div");return e.innerHTML=t,{text:e.innerText}},A=t=>{const e=document.createElement("A");return e.href=t,e},P=t=>{let{className:e,readOnly:n,preview:a,onBlur:l,placeholder:u,hideToolbar:p,border:m,domain:w,folder:P,type:T,maxHeight:D,...E}=t;const[S,q]=c()(E),M=(0,v.useRef)(!1),N=(0,v.useRef)(null),C=d()((()=>{l&&l()})),{ossApi:F,ossToStatic:L,ajax:Y,urlToOss:H}=(0,h.usePreset)(),R=(0,v.useMemo)((()=>S&&"[object Object]"===Object.prototype.toString.call(S)?S.hasOwnProperty("ops")?S:S.hasOwnProperty("blocks")?(t=>{const e=[];for(let n=0;n<(t.blocks||[]).length;n++){const a=t.blocks[n];if(a.data&&("header"===a.type&&(e.push({insert:"".concat(I(a.data.text).text)}),e.push({attributes:{header:a.data.level},insert:"\n"})),"paragraph"===a.type&&e.push({insert:"".concat(I(a.data.text).text,"\n")}),"delimiter"===a.type&&(e.push({attributes:{color:"#000000",size:"huge",bold:!0},insert:" * * *"}),e.push({attributes:{align:"center"},insert:"\n"})),"image"===a.type&&e.push({insert:{image:a.data.file.hasOwnProperty("id")?"".concat(window.location.origin,"/attachment/").concat(a.data.file.id,".png?id=").concat(a.data.file.id,"&originalName=").concat(a.data.file.filename):a.data.file.url}}),"list"===a.type&&(a.data.items||[]).map((t=>{e.push.apply(e,[{insert:"".concat(I(t.content).text)},{attributes:{list:"bullet"},insert:"\n"}])})),"attaches"===a.type)){const t=(0,b.get)(a.data,"file.title")||(0,b.get)(a.data,"title")||"",n=(0,b.get)(a.data,"file.extension")||t.substring(t.lastIndexOf(".")+1),r=a.data.file.hasOwnProperty("id")?"".concat(window.location.origin,"/attachment/").concat(a.data.file.id,".").concat(n,"?id=").concat(a.data.file.id,"&originalName=").concat(t):a.data.file.url;e.push.apply(e,[{attributes:{link:r},insert:t},{insert:"\n"}])}}return{ops:e}})(S):S:S&&"string"===typeof S?{ops:[{insert:"".concat(I(S).text,"\n")}]}:{ops:[]}),[S]),U=((0,v.useMemo)((()=>!(!S||"[object Object]"!==Object.prototype.toString.call(S)||!S.hasOwnProperty("blocks"))),[S]),async(t,e)=>{const n=A(t),a=new URLSearchParams(n.search),r=null===a||void 0===a?void 0:a.get("id"),o=n.pathname.substring(n.pathname.lastIndexOf("/")+1),s=r||o.substring(0,o.lastIndexOf("."));if(s){const{data:n}=await Y((0,b.merge)({},F,{params:{id:s},showError:!1})),a=F.transformData?F.transformData(n):n.data;return a?await H({url:x()(a),folder:e}):t}const i=await H({url:t,folder:e});return i||t}),z=async()=>{const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.click(),t.onchange=()=>{const e=t.files[0],n=y.message.loading("\u4e0a\u4f20\u4e2d...",0);L({file:e,folder:P}).then((t=>{var e;let a=null===N||void 0===N||null===(e=N.current)||void 0===e?void 0:e.getEditor();const r=a.getSelection().index;a.insertEmbed(r,"image",t,"api"),a.setSelection(r+1),n()}))}},B=async()=>{var t,e;if(N.current){var n=null===(t=C.current)||void 0===t?void 0:t.querySelectorAll(".ql-container img");for(let t=0;t<n.length;t++){const e=n[t];let a=A(e.src);const r=new Image;r.src=e.src;const o=w.some((t=>t.host===a.hostname)),s=w.some((t=>t.host===a.hostname&&!0===t.update));if(o)r.onerror=()=>{s&&U(e.src,P).then((t=>{e.src=t}))};else if(/^data:image/.test(e.src)){const t=(0,b.uniqueId)("base64_")+(new Date).getTime(),n=_(e.src,t);L({file:n,folder:P}).then((async t=>{e.src=t}))}else O(e.src)&&H({url:x()(e.src),folder:P}).then((t=>{t&&(e.src=t)}))}var a=null===(e=C.current)||void 0===e?void 0:e.querySelectorAll(".ql-container a");for(let t=0;t<a.length;t++){const e=a[t];if(O(e.href)){let t=A(e.href);w.some((e=>e.host===t.hostname&&!0===e.update))&&U(e.href,P).then((t=>{e.href=t}))}}}},V=(0,v.useMemo)((()=>({toolbar:{container:k,handlers:{image:t=>{z.call(void 0,E)}}}})),[]);return(0,v.useEffect)((()=>{M.current=!1;const t=setInterval((()=>{N.current&&N.current.editor&&(M.current=!0,B(),clearInterval(t))}),10);return()=>{t&&clearInterval(t)}}),[]),(0,j.jsx)("div",{ref:C,style:{"--max-height":D&&!(0,b.isNaN)(parseFloat(D))?parseFloat(D)+"px":""},className:g()(e,r,{[o]:a||n,[s]:a||p||n,[i]:!1===m}),children:(0,j.jsx)(f(),{ref:N,readOnly:n,modules:V,value:"html"===T?S:R,placeholder:u,theme:"snow",onChange:async(t,e,n,a)=>{const r="html"===T?a.getHTML():a.getContents();B();const o="html"===T?r:await(async t=>{const e=(0,b.get)(t,"ops")||[];for(let n=0;n<e.length;n++){const t=e[n],a=(0,b.get)(t,"insert.image");if(a){let e=A(a);const n=w.some((t=>t.host===e.hostname)),r=w.some((t=>t.host===e.hostname&&!0===t.update));if(n){const e=r?await U(a,P):a;t.insert.image=e}else if(/^data:image/.test(a)){const e=(0,b.uniqueId)("base64_")+(new Date).getTime(),n=_(a,e),r=await L({file:n,folder:P});t.insert.image=r}else if(O(a)){const e=await H({url:x()(a),folder:P});t.insert.image=e||a}}}return{ops:e}})(r);q&&q(o)}})})};P.defaultProps={placeholder:"\u8bf7\u8f93\u5165",hideToolbar:!1,border:!0,value:null,readOnly:!1,preview:!1,defaultValue:{ops:[]},folder:"richEditor",domain:[{host:"localhost",update:!0},{host:"attachment.dev.fatalent.cn",update:!0},{host:"attachment.test.fatalent.cn",update:!0},{host:"attachment.fatalent.cn",update:!0},{host:"fat-dev-static.oss-cn-shanghai.aliyuncs.com"},{host:"fat-test-static.oss-cn-shanghai.aliyuncs.com"},{host:"fat-static.oss-cn-shanghai.aliyuncs.com"}]};const T=P,{useOnBlur:D}=a.hooks,E=t=>D(t)(T);E.Field=E.field=T;const S=E},94710:t=>{t.exports=function(t,e,n,a){for(var r=-1,o=null==t?0:t.length;++r<o;){var s=t[r];e(a,s,n(s),t)}return a}},32952:(t,e,n)=>{var a=n(45652);t.exports=function(t,e,n,r){return a(t,(function(t,a,o){e(r,t,n(t),o)})),r}},45652:(t,e,n)=>{var a=n(94664),r=n(76516)(a);t.exports=r},99910:t=>{t.exports=function(t,e){for(var n,a=-1,r=t.length;++a<r;){var o=e(t[a]);void 0!==o&&(n=void 0===n?o:n+o)}return n}},19449:(t,e,n)=>{var a=n(94710),r=n(32952),o=n(9096),s=n(54052);t.exports=function(t,e){return function(n,i){var l=s(n)?a:r,c=e?e():{};return l(n,t,o(i,2),c)}}},76516:(t,e,n)=>{var a=n(6571);t.exports=function(t,e){return function(n,r){if(null==n)return n;if(!a(n))return t(n,r);for(var o=n.length,s=e?o:-1,i=Object(n);(e?s--:++s<o)&&!1!==r(i[s],s,i););return n}}},26304:(t,e,n)=>{var a=n(53871),r=n(76759);t.exports=function(t,e,n){var o=null==t?0:t.length;return o?(e=n||void 0===e?1:r(e),a(t,0,(e=o-e)<0?0:e)):[]}},39835:(t,e,n)=>{var a=n(71775),r=n(19449),o=Object.prototype.hasOwnProperty,s=r((function(t,e,n){o.call(t,n)?t[n].push(e):a(t,n,[e])}));t.exports=s},56641:(t,e,n)=>{var a=n(26989);t.exports=function(t,e,n){var r=(n="function"==typeof n?n:void 0)?n(t,e):void 0;return void 0===r?a(t,e,void 0,n):!!r}},60262:(t,e,n)=>{var a=n(99910),r=n(33279);t.exports=function(t){return t&&t.length?a(t,r):0}},76759:(t,e,n)=>{var a=n(37303);t.exports=function(t){var e=a(t),n=e%1;return e===e?n?e-n:e:0}},17448:()=>{},71975:()=>{},25884:()=>{}}]);
//# sourceMappingURL=9390.561bfdd1.chunk.js.map