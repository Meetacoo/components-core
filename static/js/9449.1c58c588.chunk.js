(self.webpackChunk_kne_components_components_core=self.webpackChunk_kne_components_components_core||[]).push([[9449,9034,1190],{24474:(e,t,s)=>{"use strict";s.r(t),s.d(t,{DragArea:()=>K,DragAreaOuter:()=>J,DragButton:()=>X,FileUpload:()=>ne,Title:()=>G,UploadButton:()=>q,UploadTips:()=>V,default:()=>se});var i=s(73884),n=s(33097),a=s.n(n),l=s(55199);const r="style_file-list-outer__wPhbb__ujG5g",o="style_file-list-title__zXM5r__ujG5g",c="style_container__P4RaF__ujG5g",d="style_file-preview-inner__cvE72__ujG5g",u="style_file-preview__M-Asq__ujG5g",p="style_drag-area__Q+lm7__ujG5g",m="style_upload-drag-close__u5o8W__ujG5g",g="style_upload-drag-tips__z7puZ__ujG5g",x="style_upload-drag-icon__sGGoS__ujG5g",j="style_upload-drag-title__9Afmb__ujG5g",_="style_upload-drag-text__o38vS__ujG5g",h="style_title-group__8IJkS__ujG5g",f="style_upload-btn__Q+Jxn__ujG5g",v="style_total-count__z1fyd__ujG5g",y="style_file-select__mHqyI__ujG5g",S="style_file-name__QkvMn__ujG5g",N="style_file-select-info__fOLiM__ujG5g",F="style_file-select-option__AbDrD__ujG5g";var P=s(75087),L=s.n(P),b=s(74065),w=s.n(b),C=s(57469),M=s.n(C),T=s(64671),z=s(67390),D=s(58609),I=s(70579);const E=e=>{let{currentTab:t,setCurrentTab:s,previewMap:i,previewList:n,getPermission:a,currentPreviewFileId:r,setCurrentPreviewFileId:c,itemApis:d,children:u,maxWidth:p,getPopupContainer:m}=e;return(0,I.jsx)("div",{className:o,children:(0,I.jsxs)(l.Row,{align:"middle",justify:"space-between",wrap:!1,children:[(0,I.jsx)(l.Col,{children:(0,I.jsxs)(l.Space,{className:h,size:4,children:[(0,I.jsx)(l.Segmented,{value:t,onChange:s,options:[{label:(0,I.jsxs)(l.Space,{size:4,children:[(0,I.jsx)(T.default,{type:"icon-shitu-liebiao"}),(0,I.jsx)(D.FormattedMessage,{id:"listText",moduleName:"FileList"})]}),value:"list"},{label:(0,I.jsxs)(l.Space,{size:4,children:[(0,I.jsx)(T.default,{type:"icon-shitu-yulan"}),(0,I.jsx)(D.FormattedMessage,{id:"previewText",moduleName:"FileList"})]}),value:"preview"}]}),"preview"===t&&r&&i.get(r)&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(l.Select,{className:y,bordered:!1,popupMatchSelectWidth:!1,value:r,onChange:c,getPopupContainer:m,children:n.map((e=>{let{filename:t,userName:s,date:i,ossId:n}=e;return(0,I.jsx)(l.Select.Option,{className:F,value:n,children:(0,I.jsxs)(l.Space,{direction:"vertical",children:[(0,I.jsxs)(l.Space,{size:4,align:"start",children:[(0,I.jsx)(L(),{type:w()(t.split(".")),size:14}),(0,I.jsx)(l.Typography.Text,{className:S,ellipsis:!0,style:{"--max-width":"".concat(p,"px")},children:t})]}),s||i?(0,I.jsxs)(l.Space,{className:N,size:24,children:[(0,I.jsxs)("div",{children:[(0,I.jsx)(D.FormattedMessage,{id:"uploadUser",moduleName:"FileList"}),":",s]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(D.FormattedMessage,{id:"uploadTime",moduleName:"FileList"}),":",i&&M()(i).format("YYYY-MM-DD HH:mm:ss")]})]}):null]})},n)}))}),(0,I.jsx)(z.OptionButtons,{hasPreview:!1,getPermission:a,item:i.get(r),apis:d}),(0,I.jsx)("div",{className:v,children:(0,I.jsx)(D.FormattedMessage,{id:"totalCount",values:{count:n.length},moduleName:"FileList"})})]})]})}),(0,I.jsx)(l.Col,{children:u})]})})};E.defaultProps={maxWidth:260};const G=E,A=e=>({"en-US":()=>s.e(5714).then(s.bind(s,63333)),"zh-CN":()=>s.e(8795).then(s.bind(s,48795))}[e]());var O=s(70720),U=s.n(O),k=s(83136),B=s.n(k);const R=(0,i.createContext)({}),{Provider:W}=R,Y=()=>(0,i.useContext)(R);var H=s(29574),Q=s(81348);const X=e=>{let{children:t}=e;const{onOpenChange:s,getDragButtonEl:i}=Y();return(0,I.jsx)("div",{ref:i,className:f,onClick:()=>{s((e=>!e))},children:(0,I.jsxs)(l.Typography.Text,{className:"ant-btn",children:[(0,I.jsx)(T.default,{type:"icon-tuozhuaishangchuan"}),t||(0,I.jsx)(D.FormattedMessage,{id:"dragText",moduleName:"FileList"})]})})},q=e=>{let{children:t}=e;const{accept:s,onFileSelected:i}=Y();return(0,I.jsxs)(H.AG,{className:f,accept:s,multiple:!0,onChange:i,children:[(0,I.jsx)(T.default,{type:"icon-tianjia"}),t]})},J=e=>{let{title:t,accept:s,fileSize:n,maxLength:a,onFileSelected:o,children:d,className:u}=e;const[p,m]=(0,i.useState)(!1),g=(0,i.useRef)(null),x=U()((e=>{g.current&&(g.current.contains(e.target)||e.target===g.current||m(!1))}));return(0,I.jsx)(D.IntlProvider,{importMessages:A,moduleName:"FileList",children:(0,I.jsx)(W,{value:{open:p,onOpenChange:m,accept:s,fileSize:n,maxLength:a,onFileSelected:o,getDragButtonEl:e=>{g.current=e}},children:(0,I.jsxs)(l.Space,{className:r,direction:"vertical",children:[t,(0,I.jsx)("div",{className:B()(c,u),ref:x,onDragEnter:()=>{m(!0)},children:d})]})})})};J.defaultProps={fileSize:20,accept:[".png",".jpg",".pdf",".docx",".doc"]};const V=e=>{let{icon:t,title:s,renderTips:i}=e;const{accept:n,fileSize:a,maxLength:l}=Y(),r=i((0,D.useIntl)({moduleName:"FileList"}).formatMessage({id:"dragTips"},{accept:n.map((e=>e.replace(/^\./,""))).join("\u3001"),size:a}),{fileSize:a,maxLength:l,accept:n});return(0,I.jsxs)("div",{className:B()(g,"upload-drag-tips"),children:[(0,I.jsx)("div",{className:x,children:t||(0,I.jsx)(T.default,{type:"icon-shangchuan",size:64})}),(0,I.jsx)("div",{className:j,children:s||(0,I.jsx)(D.FormattedMessage,{id:"dragTitle",moduleName:"FileList"})}),(0,I.jsx)("div",{className:_,children:r})]})};V.defaultProps={renderTips:e=>e};const Z=e=>{let{children:t,className:s}=e;const{open:i,accept:n,onOpenChange:a,onFileSelected:r}=Y();return i?(0,I.jsxs)("div",{className:B()(p,s),onDragOver:e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},onDrop:e=>{if(e.stopPropagation(),e.preventDefault(),0===e.dataTransfer.files.length)return;a(!1);const t=Array.from(e.dataTransfer.files).filter((e=>(0,Q.A)(e,n)));r(t)},onDragEnd:()=>{a(!1)},children:[(0,I.jsx)(l.Button,{className:m,type:"text",shape:"circle",size:"small",icon:(0,I.jsx)(T.default,{type:"icon-close-bold"}),onClick:()=>{a(!1)}}),t]}):null};Z.defaultProps={children:(0,I.jsx)(V,{})};const K=Z;var $=s(10419),ee=s(76329);const te=e=>{var t;let{maxLength:s,list:n,setList:r,defaultTab:o,apis:c,getPermission:p,titleExtra:m,fileSize:g,accept:x,getPopupContainer:j}=e;const{apis:_}=(0,ee.usePreset)(),h=Object.assign({},_,c),{fileList:f,onFileSelected:v}=(0,H.lN)({maxLength:s,multiple:!0,value:n,onChange:r,concurrentCount:1,onAdd:()=>{S("list")},onSave:h.onSave,ossUpload:h.ossUpload}),[y,S]=(0,i.useState)(o),{formatMessage:N}=(0,D.useIntl)({moduleName:"FileList"}),{message:F}=l.App.useApp(),P=(0,i.useMemo)((()=>new Map(n.map((e=>[e.ossId,e])))),[n]),[L,b]=(0,i.useState)(a()(n,"[0].ossId",null));(0,i.useEffect)((()=>{L&&P.get(L)||b(a()(n,"[0].ossId",null))}),[n,P,L]);const w={onPreview:e=>{b(e.ossId),S("preview")},onDelete:async e=>{h.onDelete&&await h.onDelete(e),r((t=>{const s=t.slice(0),i=t.findIndex((t=>{let{ossId:s}=t;return s===e.ossId}));return i>-1&&s.splice(i,1),s})),F.success(N({id:"successDelete"},{name:e.filename}))},onEdit:async e=>{let{formData:t,item:s}=e;h.onEdit&&await h.onEdit({formData:t,item:s}),r((e=>{const i=e.slice(0),n=e.findIndex((e=>{let{ossId:t}=e;return t===s.ossId}));return n>-1&&i.splice(n,1,Object.assign({},s,{filename:t.name})),i})),F.success(N({id:"successEditFileName"},{name:s.filename}))}},C="function"===typeof m?m({currentPreviewFileId:L,currentTab:y}):m;return(0,I.jsxs)(J,{title:(0,I.jsx)(G,{currentTab:y,setCurrentTab:S,previewMap:P,previewList:n,getPermission:p,currentPreviewFileId:L,setCurrentPreviewFileId:b,itemApis:w,getPopupContainer:j,children:(0,I.jsxs)(l.Space,{split:(0,I.jsx)(l.Divider,{type:"vertical"}),children:[C,p("add",{})?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(X,{children:(0,I.jsx)(D.FormattedMessage,{id:"dragText",moduleName:"FileList"})}),(0,I.jsx)(q,{children:(0,I.jsx)(D.FormattedMessage,{id:"uploadFile",moduleName:"FileList"})})]}):null]})}),fileSize:g,maxLength:s,onFileSelected:v,accept:x,children:["list"===y?(0,I.jsx)(z.List,{dataSource:[...f,...n],getPermission:p,apis:w}):null,"preview"===y?L?(0,I.jsx)("div",{className:d,children:(0,I.jsx)($.default,{className:u,id:L,apis:h,originName:null===(t=P.get(L))||void 0===t?void 0:t.filename})}):(0,I.jsx)(l.Empty,{image:l.Empty.PRESENTED_IMAGE_SIMPLE,className:"ant-empty-normal"}):null,(0,I.jsx)(K,{})]})};te.defaultProps={defaultTab:"list",titleExtra:null,accept:[".png",".jpg",".pdf",".docx",".doc"],fileSize:20,maxLength:Number.MAX_VALUE,getPermission:()=>!0};const se=e=>(0,I.jsx)(D.IntlProvider,{importMessages:A,moduleName:"FileList",children:(0,I.jsx)(te,{...e})}),ie=e=>{let{maxLength:t,list:s,setList:i,apis:n,getPermission:a,fileSize:r,accept:o}=e;const{apis:c}=(0,ee.usePreset)(),d=Object.assign({},c,n),{fileList:u,onFileSelected:p}=(0,H.lN)({maxLength:t,multiple:!0,value:s,onChange:i,concurrentCount:1,onSave:d.onSave,ossUpload:d.ossUpload});return(0,I.jsxs)(J,{title:(0,I.jsxs)(l.Row,{children:[(0,I.jsx)(l.Col,{flex:1}),(0,I.jsx)(l.Col,{children:(0,I.jsxs)(l.Space,{split:(0,I.jsx)(l.Divider,{type:"vertical"}),children:[(0,I.jsx)(X,{}),(0,I.jsx)(q,{children:"\u4e0a\u4f20"})]})})]}),fileSize:r,maxLength:t,onFileSelected:p,accept:o,children:[(0,I.jsx)(z.List,{dataSource:[...u,...s],getPermission:a,apis:d}),(0,I.jsx)(K,{})]})};ie.defaultProps={accept:[".png",".jpg",".pdf",".docx",".doc"],fileSize:20,maxLength:Number.MAX_VALUE,getPermission:()=>!0};const ne=ie},94710:e=>{e.exports=function(e,t,s,i){for(var n=-1,a=null==e?0:e.length;++n<a;){var l=e[n];t(i,l,s(l),e)}return i}},32952:(e,t,s)=>{var i=s(45652);e.exports=function(e,t,s,n){return i(e,(function(e,i,a){t(n,e,s(e),a)})),n}},45652:(e,t,s)=>{var i=s(94664),n=s(76516)(i);e.exports=n},99910:e=>{e.exports=function(e,t){for(var s,i=-1,n=e.length;++i<n;){var a=t(e[i]);void 0!==a&&(s=void 0===s?a:s+a)}return s}},19449:(e,t,s)=>{var i=s(94710),n=s(32952),a=s(9096),l=s(54052);e.exports=function(e,t){return function(s,r){var o=l(s)?i:n,c=t?t():{};return o(s,e,a(r,2),c)}}},76516:(e,t,s)=>{var i=s(6571);e.exports=function(e,t){return function(s,n){if(null==s)return s;if(!i(s))return e(s,n);for(var a=s.length,l=t?a:-1,r=Object(s);(t?l--:++l<a)&&!1!==n(r[l],l,r););return s}}},26304:(e,t,s)=>{var i=s(53871),n=s(99140);e.exports=function(e,t,s){var a=null==e?0:e.length;return a?(t=s||void 0===t?1:n(t),i(e,0,(t=a-t)<0?0:t)):[]}},39835:(e,t,s)=>{var i=s(71775),n=s(19449),a=Object.prototype.hasOwnProperty,l=n((function(e,t,s){a.call(e,s)?e[s].push(t):i(e,s,[t])}));e.exports=l},56641:(e,t,s)=>{var i=s(26989);e.exports=function(e,t,s){var n=(s="function"==typeof s?s:void 0)?s(e,t):void 0;return void 0===n?i(e,t,void 0,s):!!n}},60262:(e,t,s)=>{var i=s(99910),n=s(33279);e.exports=function(e){return e&&e.length?i(e,n):0}},99140:(e,t,s)=>{var i=s(37303);e.exports=function(e){var t=i(e),s=t%1;return t===t?s?t-s:t:0}},17448:()=>{},71975:()=>{}}]);
//# sourceMappingURL=9449.1c58c588.chunk.js.map